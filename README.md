# WordPress CMS Backend Media UFU-Vulnerability
WordPress CMS <= v6.5.4 is affected by UFU Vulnerability which allows Cross-Site Scriting (XSS) stored.

## Vulnerability type
File Upload Vulnerability, Cross-Site Scripting (XSS) Vulnerability

## Description of the vulnerability
WordPress is a free and open-source blogging software and content management system (CMS) based on PHP and MySQL. 

WordPress CMS versions up to and including 6.5.4 backend have a file upload vulnerability. Attackers can exploit this vulnerability via the Media web page to upload malicious files containing arbitrary JavaScript scripts, thereby carrying out cross-site scripting (XSS) attacks.

## Impact
Attackers can use this vulnerability to execute arbitrary JavaScript code in the victim's browser. 
If the victim has high privileges (such as Administrator), the attacker can create a super administrator account, take over the backend management system.
What's more, the attacker could remotely control the web server, and execute arbitrary code.

## Reproducing the vulnerability
### Forge a Malicious HTML File as a GZIP Type.
First, modify the file name by changing the file extension to .gzip.
Next, modify the file content by appending 8 bytes of a JPG file header to the end of the original file content.
![image](https://github.com/starrychen1122/WordPress-Media-UFU-Vulnerability/assets/57283914/97541ac1-f440-4d10-a551-61b1b69fb404)


### An attacker with Author privileges can construct an HTTP request and upload the forged malicious HTML file through the Media API.
The forged file, when uploaded, is identified by WordPress as an application/x-gzip type based on its file extension.
During content inspection, it is identified as an unknown type application/octet-stream.
According to WordPress's code logic, the uploaded file is finally recognized as a normal application/x-gzip type file, bypassing the file upload filtering mechanism and successfully uploading it to the server.
![image](https://github.com/starrychen1122/WordPress-Media-UFU-Vulnerability/assets/57283914/00487cf2-628d-40d9-ae27-64d617640d9c)
The URL of the uploaded file can be acheived from the web page:
![image](https://github.com/starrychen1122/WordPress-Media-UFU-Vulnerability/assets/57283914/00472e56-27c3-4a8c-86dd-6dde592d829f)

### Trick the victim into visiting the file via the URL, which will execute the JavaScript script in the victim's browser.
![image](https://github.com/starrychen1122/WordPress-Media-UFU-Vulnerability/assets/57283914/88f27fe0-d251-46f0-b56a-2f6979da9f4a)

### Further Exploitation1:
The attacker writes a JavaScript script to create a super administrator (Administrator) account in the uploaded file.
The attacker then exploits this vulnerability to upload the file to the web server.
![image](https://github.com/starrychen1122/WordPress-Media-UFU-Vulnerability/assets/57283914/b2cf932e-a88b-486f-9ae0-169ef0a99dde)


### Once a victim with Administrator privileges visits the file via the URL, the script will execute in their browser, using the victim's authentication information to request the creation of a new administrator account.
![image](https://github.com/starrychen1122/WordPress-Media-UFU-Vulnerability/assets/57283914/4eb3fedf-e876-4d72-855d-d97c26eca9bb)



### The attacker logs in using the newly created Administrator account, successfully taking over the backend system.
![image](https://github.com/starrychen1122/WordPress-Media-UFU-Vulnerability/assets/57283914/1832419d-c38c-4efe-9b59-10f83bdf9836)

### Further Exploitation2:
The attacker can modify existing PHP files in the backend to include a web shell.
This allows the attacker to control the web server and remotely execute arbitrary PHP code.
![image](https://github.com/starrychen1122/WordPress-REST-API-UFU-Vulnerability/assets/57283914/46b3d964-0fca-47b0-a1b6-821766fcebab)
![image](https://github.com/starrychen1122/WordPress-REST-API-UFU-Vulnerability/assets/57283914/9de5c2b6-6f91-4e27-91ea-745353fca95d)

Successfully Execute System Commands!
